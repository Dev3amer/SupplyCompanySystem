<UserControl x:Class="SupplyCompanySystem.UI.Views.ReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SupplyCompanySystem.UI.Converters"
             xmlns:conv="clr-namespace:SupplyCompanySystem.UI.Converters"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             Background="White"
             FlowDirection="RightToLeft"
             d:DesignHeight="700" d:DesignWidth="1200"
             PreviewMouseDown="UserControl_PreviewMouseDown">

    <UserControl.Resources>
        <!-- المحولات الأساسية -->
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <conv:ReportTypeConverter x:Key="ReportTypeConverter"/>
        <conv:RowNumberConverter x:Key="RowNumberConverter"/>
        <conv:SalesTrendColorConverter x:Key="SalesTrendColorConverter"/>
        <conv:LeastProductsVisibilityConverter x:Key="LeastProductsVisibilityConverter"/>
        <conv:TopInvoiceCustomersVisibilityConverter x:Key="TopInvoiceCustomersVisibilityConverter"/>
        <conv:AmountToFormattedStringConverter x:Key="AmountToFormattedStringConverter"/>
        <conv:PercentageToColorConverter x:Key="PercentageToColorConverter"/>

        <!-- ✅ ستايل موحد للأزرار الأساسية -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- ✅ ستايل للأزرار الإضافية -->
        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- ✅ ستايل لأزرار التصدير الأساسية -->
        <Style x:Key="ExportButtonStyle" TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
            <Setter Property="Width" Value="180"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- ✅ ستايل لزر إعادة التعيين في الفلاتر -->
        <Style x:Key="FilterResetButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="#E67E22"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="28"/>
        </Style>

        <!-- ✅ أنماط الألوان للتقرير -->
        <Style x:Key="SummaryCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" Opacity="0.1" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="StatValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="StatLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#7F8C8D"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- ✅ ستايل DataGrid محسن مع إصلاح رؤوس الأعمدة -->
        <Style x:Key="ReportDataGrid" TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="RowHeight" Value="35"/>
            <Setter Property="Margin" Value="0,10,0,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="AlternatingRowBackground" Value="#F8F9FA"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="GridLinesVisibility" Value="All"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#E0E0E0"/>
            <Setter Property="VerticalGridLinesBrush" Value="#E0E0E0"/>
            <Setter Property="ColumnHeaderHeight" Value="35"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>

            <!-- ستايل رأس العمود - إصلاح -->
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#34495E"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="11"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="BorderBrush" Value="#2C3E50"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="Padding" Value="8,6"/>
                        <Setter Property="Height" Value="35"/>
                        <Setter Property="Cursor" Value="Hand"/>
                    </Style>
                </Setter.Value>
            </Setter>

            <!-- ستايل الصف -->
            <Setter Property="RowStyle">
                <Setter.Value>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="#FFFFFF"/>
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="MinHeight" Value="35"/>
                        <Setter Property="IsEnabled" Value="True"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F5F5F5"/>
                                <Setter Property="Foreground" Value="#1A1A1A"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>

            <!-- ستايل الخلية -->
            <Setter Property="CellStyle">
                <Setter.Value>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Padding" Value="6"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="BorderBrush" Value="#E0E0E0"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="IsEnabled" Value="True"/>
                        <Setter Property="IsHitTestVisible" Value="False"/>
                        <Setter Property="Focusable" Value="False"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="BorderBrush" Value="#1A5490"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ✅ أنماط للرسوم البيانية -->
        <Style x:Key="ChartCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" Opacity="0.1" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ChartTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <!-- ألوان للرسوم البيانية -->
        <SolidColorBrush x:Key="ChartColor1" Color="#3498DB"/>
        <SolidColorBrush x:Key="ChartColor2" Color="#2ECC71"/>
        <SolidColorBrush x:Key="ChartColor3" Color="#E74C3C"/>
        <SolidColorBrush x:Key="ChartColor4" Color="#9B59B6"/>
        <SolidColorBrush x:Key="ChartColor5" Color="#F39C12"/>

        <!-- ألوان التدرج للرسوم البيانية -->
        <LinearGradientBrush x:Key="GradientBlue" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#3498DB" Offset="0"/>
            <GradientStop Color="#2980B9" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="GradientGreen" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#2ECC71" Offset="0"/>
            <GradientStop Color="#27AE60" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="GradientOrange" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F39C12" Offset="0"/>
            <GradientStop Color="#D35400" Offset="1"/>
        </LinearGradientBrush>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ============ فلتر التقارير ============ -->
        <Border Grid.Row="0" Background="#F8F9FA" Padding="15" 
                BorderThickness="0,0,0,1" BorderBrush="#E0E0E0">
            <Grid Margin="0,0,0,-6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- نوع التقرير -->
                <TextBlock Grid.Column="0" Text="نوع التقرير:" 
                           Foreground="#2C3E50" FontSize="12" 
                           VerticalAlignment="Center" Margin="0,0,10,0"/>

                <ComboBox Grid.Column="1" 
                          ItemsSource="{Binding ReportTypes}" 
                          SelectedItem="{Binding SelectedReportType}" 
                          FontSize="12" Padding="5" Height="28">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Converter={StaticResource ReportTypeConverter}}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- من التاريخ -->
                <TextBlock Grid.Column="2" Text="من:" 
                           Foreground="#2C3E50" FontSize="12" 
                           VerticalAlignment="Center" Margin="20,0,10,0"
                           Visibility="{Binding IsSalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <DatePicker Grid.Column="3" 
                            SelectedDate="{Binding FromDate}" 
                            FontSize="12" Padding="4" Height="28"
                            DisplayDateEnd="{x:Static sys:DateTime.Today}"
                            Visibility="{Binding IsSalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- إلى التاريخ -->
                <TextBlock Grid.Column="4" Text="إلى:" 
                           Foreground="#2C3E50" FontSize="12" 
                           VerticalAlignment="Center" Margin="10,0,10,0"
                           Visibility="{Binding IsSalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <DatePicker Grid.Column="5" 
                            SelectedDate="{Binding ToDate}" 
                            FontSize="12" Padding="4" Height="28"
                            DisplayDateEnd="{x:Static sys:DateTime.Today}"
                            Visibility="{Binding IsSalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- السنة (للمبيعات الشهرية) -->
                <TextBlock Grid.Column="6" Text="السنة:" 
                           Foreground="#2C3E50" FontSize="12" 
                           VerticalAlignment="Center" Margin="20,0,10,0"
                           Visibility="{Binding IsMonthlySalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <ComboBox Grid.Column="7" 
                          ItemsSource="{Binding AvailableYears}" 
                          SelectedItem="{Binding SelectedYear}" 
                          FontSize="12" Padding="8" Height="28"
                          Visibility="{Binding IsMonthlySalesReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- عدد النتائج -->
                <TextBlock Grid.Column="8" Text="عدد النتائج:" 
                           Foreground="#2C3E50" FontSize="12" 
                           VerticalAlignment="Center" Margin="20,0,10,0"
                           HorizontalAlignment="Right"
                           Visibility="{Binding IsTopListReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <ComboBox Grid.Column="9" 
                          ItemsSource="{Binding AvailableLimits}" 
                          SelectedItem="{Binding TopLimit}" 
                          Width="80" FontSize="12" Padding="8" Height="28"
                          Visibility="{Binding IsTopListReport, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- ⭐ زر إعادة تعيين الفلاتر -->
                <Button Grid.Column="10" 
                        Content="🔄 إعادة تعيين" 
                        Command="{Binding ResetFiltersCommand}"
                        Style="{StaticResource FilterResetButtonStyle}"
                        ToolTip="إعادة تعيين جميع الفلاتر إلى القيم الافتراضية"/>
            </Grid>
        </Border>

        <!-- ============ منطقة عرض التقرير مع ScrollViewer محسن ============ -->
        <ScrollViewer x:Name="MainScrollViewer"
                      Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      PanningMode="VerticalOnly"
                      VerticalAlignment="Stretch"
                      HorizontalAlignment="Stretch">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- مؤشر التحميل -->
                <Border Grid.Row="0" 
                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                        Background="#F8F9FA" Padding="20" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⏳ جاري إنشاء التقرير..." 
                                   Foreground="#3498DB" FontSize="14" FontWeight="Bold"
                                   VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ProgressBar Width="200" Height="10" IsIndeterminate="True"/>
                    </StackPanel>
                </Border>

                <!-- التقرير الفعلي -->
                <Grid Grid.Row="1" Margin="15" 
                      Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}">

                    <!-- ⭐⭐⭐ صفحة ملخص المبيعات المحسنة ⭐⭐⭐ -->
                    <Grid Visibility="{Binding IsSummaryReport, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- ⭐ العنوان والملخص -->
                        <Border Grid.Row="0" Background="#34495E" CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="📊 ملخص المبيعات الشامل" 
                                           Foreground="White" FontSize="18" FontWeight="Bold"
                                           HorizontalAlignment="Center" Margin="0,0,0,10"/>

                                <TextBlock Text="{Binding QuickStatsText}" 
                                           Foreground="#BDC3C7" FontSize="13"
                                           HorizontalAlignment="Center" TextWrapping="Wrap"
                                           TextAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <!-- ⭐ الصف الأول من بطاقات الإحصائيات (4 بطاقات) -->
                        <WrapPanel Grid.Row="1" Orientation="Horizontal" 
                                   HorizontalAlignment="Center" Margin="0,0,0,10">

                            <!-- إجمالي المبيعات قبل الخصم -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalSalesAmount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#3498DB"/>
                                    <TextBlock Text="إجمالي المبيعات" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="قبل الخصم" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- إجمالي الخصومات -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalDiscountAmount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#E74C3C"/>
                                    <TextBlock Text="إجمالي الخصومات" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding SalesSummary.DiscountPercentage, StringFormat='نسبة {0:N1}%'}" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- المبلغ الصافي بعد الخصم -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalNetAmount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#2ECC71"/>
                                    <TextBlock Text="المبلغ الصافي" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="بعد الخصم" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- إجمالي الربح -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalProfitAmount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#9B59B6"/>
                                    <TextBlock Text="إجمالي الربح" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding SalesSummary.ProfitMargin, StringFormat='هامش {0:N1}%'}" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                        </WrapPanel>

                        <!-- ⭐ الصف الثاني من بطاقات الإحصائيات (4 بطاقات) -->
                        <WrapPanel Grid.Row="2" Orientation="Horizontal" 
                                   HorizontalAlignment="Center" Margin="0,0,0,20">

                            <!-- متوسط الخصم لكل فاتورة -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.AverageDiscountPerInvoice, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#F39C12"/>
                                    <TextBlock Text="متوسط الخصم" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="{Binding SalesSummary.DiscountedInvoicesCount, StringFormat='على {0} فاتورة'}" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- عدد الفواتير -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalInvoices}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#3498DB"/>
                                    <TextBlock Text="عدد الفواتير" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- عدد العملاء -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.TotalCustomers}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#2ECC71"/>
                                    <TextBlock Text="عدد العملاء" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="عملاء متفاعلين" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- متوسط الفاتورة -->
                            <Border Style="{StaticResource SummaryCardStyle}" Width="180" Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding SalesSummary.AverageInvoiceAmount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatValueStyle}"
                                               Foreground="#F39C12"/>
                                    <TextBlock Text="متوسط الفاتورة" 
                                               Style="{StaticResource StatLabelStyle}"/>
                                    <TextBlock Text="متوسط إنفاق العميل" 
                                               FontSize="10" Foreground="#95A5A6"
                                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                        </WrapPanel>

                        <!-- ⭐ الإحصائيات المتقدمة -->
                        <Grid Grid.Row="3" Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- المنتج الأكثر مبيعاً -->
                            <Border Grid.Column="0" Style="{StaticResource ChartCardStyle}" Margin="0,0,10,0">
                                <StackPanel>
                                    <TextBlock Text="🏆 المنتج الأكثر مبيعاً" 
                                               Style="{StaticResource ChartTitleStyle}"/>

                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                        <Border Width="60" Height="60" CornerRadius="30" 
                                                Background="{StaticResource GradientBlue}"
                                                VerticalAlignment="Center" Margin="0,0,15,0">
                                            <TextBlock Text="👑" FontSize="24" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>

                                        <StackPanel>
                                            <TextBlock Text="{Binding SalesSummary.MostSoldProductName}" 
                                                       FontSize="16" FontWeight="Bold" Foreground="#2C3E50"
                                                       TextWrapping="Wrap" MaxWidth="200"/>
                                            <TextBlock Text="{Binding SalesSummary.MostSoldQuantity, StringFormat='تم بيع {0} قطعة'}" 
                                                       FontSize="12" Foreground="#7F8C8D" Margin="0,5,0,0"/>
                                            <TextBlock Text="الأداء المتميز في الفترة" 
                                                       FontSize="11" Foreground="#3498DB" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- العميل الأكثر إنفاقاً -->
                            <Border Grid.Column="1" Style="{StaticResource ChartCardStyle}" Margin="10,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="⭐ العميل الأكثر إنفاقاً" 
                                               Style="{StaticResource ChartTitleStyle}"/>

                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                        <Border Width="60" Height="60" CornerRadius="30" 
                                                Background="{StaticResource GradientGreen}"
                                                VerticalAlignment="Center" Margin="0,0,15,0">
                                            <TextBlock Text="💰" FontSize="24" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>

                                        <StackPanel>
                                            <TextBlock Text="{Binding SalesSummary.TopCustomerName}" 
                                                       FontSize="16" FontWeight="Bold" Foreground="#2C3E50"
                                                       TextWrapping="Wrap" MaxWidth="200"/>
                                            <TextBlock Text="{Binding SalesSummary.TopCustomerTotal, StringFormat='أنفق {0:N0} جنيهاً'}" 
                                                       FontSize="12" Foreground="#7F8C8D" Margin="0,5,0,0"/>
                                            <TextBlock Text="عميل متميز وقيمة مضافة" 
                                                       FontSize="11" Foreground="#27AE60" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- ⭐ تاريخ التقرير -->
                        <Border Grid.Row="4" Background="#F8F9FA" CornerRadius="6" Padding="12" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🗓️" FontSize="13" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="تاريخ التقرير: " 
                                           FontSize="12" Foreground="#7F8C8D" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ToDate, StringFormat='{}{0:yyyy/MM/dd HH:mm}'}" 
                                           FontSize="12" FontWeight="Bold" Foreground="#2C3E50"
                                           Margin="5,0,0,0" VerticalAlignment="Center"/>
                                <TextBlock Text=" | الفترة: " 
                                           FontSize="12" Foreground="#7F8C8D" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding FromDate, StringFormat='{}{0:yyyy/MM/dd}'}" 
                                           FontSize="12" FontWeight="Bold" Foreground="#3498DB"
                                           Margin="5,0,0,0" VerticalAlignment="Center"/>
                                <TextBlock Text=" إلى " 
                                           FontSize="12" Foreground="#7F8C8D" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ToDate, StringFormat='{}{0:yyyy/MM/dd}'}" 
                                           FontSize="12" FontWeight="Bold" Foreground="#3498DB"
                                           Margin="5,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- ⭐⭐⭐ باقي أنواع التقارير ⭐⭐⭐ -->

                    <!-- أكثر المنتجات مبيعاً -->
                    <DataGrid x:Name="TopProductsGrid"
                              Visibility="{Binding IsProductReport, Converter={StaticResource BoolToVisibilityConverter}}"
                              ItemsSource="{Binding TopSellingProducts}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <!-- ✅ العمود الأول: رقم الصف (محسّن) -->
                            <DataGridTextColumn Header="#" Width="50" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding Converter="{StaticResource RowNumberConverter}">
                                        <Binding RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                                        <Binding ElementName="TopProductsGrid"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- باقي الأعمدة -->
                            <DataGridTextColumn Header="اسم المنتج" Binding="{Binding ProductName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="التصنيف" Binding="{Binding Category}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="سعر الوحدة" Binding="{Binding UnitPrice, StringFormat='0.00'}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="الكمية" Binding="{Binding TotalQuantity}" Width="80" IsReadOnly="True"/>
                            <DataGridTextColumn Header="الإجمالي" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="النسبة %" Binding="{Binding PercentageOfTotal, StringFormat='0.00'}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="0,0,10,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- أقل المنتجات مبيعاً -->
                    <DataGrid x:Name="LeastProductsGrid"
                              Visibility="{Binding SelectedReportType, Converter={StaticResource LeastProductsVisibilityConverter}}"
                              ItemsSource="{Binding LeastSellingProducts}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <!-- ✅ العمود الأول: رقم الصف (محسّن) -->
                            <DataGridTextColumn Header="#" Width="50" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding Converter="{StaticResource RowNumberConverter}">
                                        <Binding RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                                        <Binding ElementName="LeastProductsGrid"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- باقي الأعمدة -->
                            <DataGridTextColumn Header="اسم المنتج" Binding="{Binding ProductName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="التصنيف" Binding="{Binding Category}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="سعر الوحدة" Binding="{Binding UnitPrice, StringFormat='0.00'}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="الكمية" Binding="{Binding TotalQuantity}" Width="80" IsReadOnly="True"/>
                            <DataGridTextColumn Header="الإجمالي" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="النسبة %" Binding="{Binding PercentageOfTotal, StringFormat='0.00'}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="0,0,10,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- أكثر العملاء إنفاقاً -->
                    <DataGrid x:Name="TopPayingCustomersGrid"
                              Visibility="{Binding IsCustomerReport, Converter={StaticResource BoolToVisibilityConverter}}"
                              ItemsSource="{Binding TopPayingCustomers}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <!-- ✅ العمود الأول: رقم الصف (محسّن) -->
                            <DataGridTextColumn Header="#" Width="50" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding Converter="{StaticResource RowNumberConverter}">
                                        <Binding RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                                        <Binding ElementName="TopPayingCustomersGrid"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- باقي الأعمدة -->
                            <DataGridTextColumn Header="اسم العميل" Binding="{Binding CustomerName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="رقم الهاتف" Binding="{Binding PhoneNumber}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="عدد الفواتير" Binding="{Binding InvoiceCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي الإنفاق" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="متوسط الفاتورة" Binding="{Binding AverageInvoiceAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="آخر فاتورة" Binding="{Binding LastInvoiceDate, StringFormat='yyyy/MM/dd'}" Width="120" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- أكثر العملاء طلباً للعروض -->
                    <DataGrid x:Name="TopInvoiceCustomersGrid"
                              Visibility="{Binding SelectedReportType, Converter={StaticResource TopInvoiceCustomersVisibilityConverter}}"
                              ItemsSource="{Binding TopInvoiceCustomers}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <!-- ✅ العمود الأول: رقم الصف (محسّن) -->
                            <DataGridTextColumn Header="#" Width="50" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding Converter="{StaticResource RowNumberConverter}">
                                        <Binding RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                                        <Binding ElementName="TopInvoiceCustomersGrid"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- باقي الأعمدة -->
                            <DataGridTextColumn Header="اسم العميل" Binding="{Binding CustomerName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="رقم الهاتف" Binding="{Binding PhoneNumber}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="عدد الفواتير" Binding="{Binding InvoiceCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي الإنفاق" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="متوسط الفاتورة" Binding="{Binding AverageInvoiceAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="آخر فاتورة" Binding="{Binding LastInvoiceDate, StringFormat='yyyy/MM/dd'}" Width="120" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- المبيعات اليومية -->
                    <DataGrid x:Name="DailySalesGrid"
                              Visibility="{Binding IsDailySalesReport, Converter={StaticResource BoolToVisibilityConverter}}"
                              ItemsSource="{Binding DailySales}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="التاريخ" Binding="{Binding Date, StringFormat='yyyy/MM/dd'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="عدد الفواتير" Binding="{Binding InvoiceCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="عدد العملاء" Binding="{Binding CustomerCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي المبيعات" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي الربح" Binding="{Binding TotalProfit, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي الخصم" Binding="{Binding TotalDiscount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- المبيعات الشهرية -->
                    <DataGrid x:Name="MonthlySalesGrid"
                              Visibility="{Binding IsMonthlySalesReport, Converter={StaticResource BoolToVisibilityConverter}}"
                              ItemsSource="{Binding MonthlySales}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="الشهر" Binding="{Binding MonthName}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="عدد الفواتير" Binding="{Binding InvoiceCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي المبيعات" Binding="{Binding TotalAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي الربح" Binding="{Binding TotalProfit, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="المتوسط" Binding="{Binding AverageAmount, StringFormat='0.00'}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="النمو %" Binding="{Binding GrowthPercentage, StringFormat='+0;-#'}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding GrowthPercentage}" Value="0">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </DataTrigger>
                                            <Trigger Property="Text" Value="">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- تقرير المخزون -->
                    <DataGrid x:Name="InventoryGrid"
                              Visibility="{Binding IsInventoryReport, Converter={StaticResource BoolToVisibilityConverter}}"
                              ItemsSource="{Binding InventoryReport}"
                              Style="{StaticResource ReportDataGrid}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <!-- ✅ العمود الأول: رقم الصف (محسّن) -->
                            <DataGridTextColumn Header="#" Width="50" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding Converter="{StaticResource RowNumberConverter}">
                                        <Binding RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                                        <Binding ElementName="InventoryGrid"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- باقي الأعمدة -->
                            <DataGridTextColumn Header="اسم المنتج" Binding="{Binding ProductName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="التصنيف" Binding="{Binding Category}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="سعر الوحدة" Binding="{Binding UnitPrice, StringFormat='0.00'}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="المبيعات الكلية" Binding="{Binding TotalSoldQuantity}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="إجمالي المبلغ" Binding="{Binding TotalSoldAmount, StringFormat='0.00'}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="آخر شهر" Binding="{Binding LastMonthSoldQuantity}" Width="80" IsReadOnly="True"/>
                            <DataGridTextColumn Header="آخر 3 شهور" Binding="{Binding LastThreeMonthsSoldQuantity}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="الاتجاه" Binding="{Binding SalesTrend}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{Binding SalesTrend, Converter={StaticResource SalesTrendColorConverter}}"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Grid>
        </ScrollViewer>

        <!-- ============ أزرار التصدير ============ -->
        <Border Grid.Row="2" Background="#F8F9FA" Padding="15" 
                BorderThickness="0,1,0,0" BorderBrush="#E0E0E0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- أزرار التصدير -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Right">

                    <!-- ✅ زر تصدير Excel -->
                    <Button Content="📥 تصدير Excel" 
                            Command="{Binding ExportExcelCommand}" 
                            Margin="0,0,10,0">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource ExportButtonStyle}">
                                <Setter Property="Background" Value="#27AE60"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Opacity" Value="1"/>
                                <Setter Property="IsEnabled" Value="True"/>
                                <Setter Property="ToolTip" Value="تصدير التقرير الحالي إلى ملف Excel"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasReportData}" Value="False">
                                        <Setter Property="Background" Value="#95A5A6"/>
                                        <Setter Property="Cursor" Value="No"/>
                                        <Setter Property="Opacity" Value="0.6"/>
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="ToolTip" Value="لا توجد بيانات للتصدير"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                        <Setter Property="Background" Value="#95A5A6"/>
                                        <Setter Property="Cursor" Value="No"/>
                                        <Setter Property="Opacity" Value="0.6"/>
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="ToolTip" Value="جاري إنشاء التقرير..."/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- ✅ زر تصدير PDF -->
                    <Button Content="📄 تصدير PDF" 
                            Command="{Binding ExportPdfCommand}" 
                            Margin="0,0,5,0">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource ExportButtonStyle}">
                                <Setter Property="Background" Value="#9B59B6"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Opacity" Value="1"/>
                                <Setter Property="IsEnabled" Value="True"/>
                                <Setter Property="ToolTip" Value="تصدير التقرير الحالي إلى ملف PDF"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasReportData}" Value="False">
                                        <Setter Property="Background" Value="#95A5A6"/>
                                        <Setter Property="Cursor" Value="No"/>
                                        <Setter Property="Opacity" Value="0.6"/>
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="ToolTip" Value="لا توجد بيانات للتصدير"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                        <Setter Property="Background" Value="#95A5A6"/>
                                        <Setter Property="Cursor" Value="No"/>
                                        <Setter Property="Opacity" Value="0.6"/>
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="ToolTip" Value="جاري إنشاء التقرير..."/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>